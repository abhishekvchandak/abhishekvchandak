<html>
<head>
<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
	<link href="css/font-awesome.min.css" rel="stylesheet" media="screen">
	<link href="css/font-awesome.css" rel="stylesheet" media="screen">
	<link href="css/simple-line-icons.css" rel="stylesheet" media="screen">
	<link href="css/animate.css" rel="stylesheet"> 
	</head>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true&callback=initialize"></script>
<script src='https://www.google.com/recaptcha/api.js'></script>
<script src='https://www.google.com/recaptcha/api.js?hl=en'></script>
<script type="text/javascript">
	var location1;
	var location2;
	
	var address1;
	var address2;

	var latlng;
	var geocoder;
	var map;
	
	var distance;


	// finds the coordinates for the two locations and calls the showMap() function
	function initialize(clicked_id)
	{
		
		geocoder = new google.maps.Geocoder(); // creating a new geocode object
		
		
		
		// getting the two address values
		address1 = document.getElementById("address1").value;
		address2 = document.getElementById("address2").value;
		
		address1_check = address1.toLowerCase();
		address2_check = address2.toLowerCase();
	
	if((address1!="" && address2!=""))
	{
		if((address1_check.includes("bangalore") || address1_check.includes("bengaluru")) && (address2_check.includes("bangalore") || address2_check.includes("bengaluru")))
		{
			// finding out the coordinates
			
			document.getElementById('map-container1').style.display = "block";
			
			if (geocoder) 
			{
				geocoder.geocode( { 'address': address1}, function(results, status) 
				{
					if (status == google.maps.GeocoderStatus.OK) 
					{
						//location of first address (latitude + longitude)
						location1 = results[0].geometry.location;
					} else 
					{
						alert("Geocode was not successful for the following reason: " + status);
					}
				});
				geocoder.geocode( { 'address': address2}, function(results, status) 
				{
					if (status == google.maps.GeocoderStatus.OK) 
					{
						//location of second address (latitude + longitude)
						location2 = results[0].geometry.location;
						// calling the showMap() function to create and show the map 
						showMap(clicked_id);
					} else 
					{
						alert("Geocode was not successful for the following reason: " + status);
					}
				});
			}
		}

		else
		{
			document.getElementById("deliverycharge").innerHTML = "<br><div class=\"alert alert-danger\">Goods will be delivered only in Bangalore.</div>";
			document.getElementById('map-container1').style.display = "none";
		}
	}
	}
		
	// creates and shows the map
	function showMap(clicked_id)
	{
		// center of the map (compute the mean value between the two locations)
		latlng = new google.maps.LatLng((location1.lat()+location2.lat())/2,(location1.lng()+location2.lng())/2);

		var weight;
        weight = document.getElementById("weight").value;

		// set map options
			// set zoom level
			// set center
			// map type
		var mapOptions = 
		{
			types: ['(Bangalore)'],
			componentRestrictions: {country: "in"},
			zoom: 1,
			center: latlng,
			mapTypeId: google.maps.MapTypeId.DRIVING
		};
		
		// create a new map object
			// set the div id where it will be shown
			// set the map options
			map = new google.maps.Map(document.getElementById("map-container1"), mapOptions);
		
		// show route between the points
		directionsService = new google.maps.DirectionsService();
		directionsDisplay = new google.maps.DirectionsRenderer();
		directionsDisplay.setMap(map);
		var request = {
			origin:location1, 
			destination:location2,
			travelMode: google.maps.DirectionsTravelMode.DRIVING
		};
		directionsService.route(request, function(response, status) 
		{
			if (status == google.maps.DirectionsStatus.OK) 
			{
				directionsDisplay.setDirections(response);

              if (weight < 5) {
              weight_ceil = 5;
              } else {
              weight_ceil = weight;
              }

               distance_string = response.routes[0].legs[0].distance.text;
               str_length = distance_string.length;
               left_size = str_length - 5;
               distance_substring = distance_string.substring(0,left_size);
               distance_num = parseInt(distance_substring);

               if (distance_num < 5) {
              distance_ceil = 5;
              } else if (distance_num < 10) {
              distance_ceil = 10;
              } else if (distance_num < 15) {
              distance_ceil = 15;
             } else if (distance_num < 20) {
              distance_ceil = 20;
              } else if (distance_num < 25) {
              distance_ceil = 25;
             } else if (distance_num < 30) {
               distance_ceil = 30;    
            } else {
            distance_ceil = 0;
             }

            if(clicked_id==="booknow")
			{
				delivery_charge1= 1.5*weight_ceil*distance_ceil;
				delivery_charge2 = 2.5*weight_ceil*distance_ceil;
				
				if((delivery_charge1%10)>0){
				delivery_charge1 = delivery_charge1 + (10 - (delivery_charge1%10));
				}
				
				if((delivery_charge2%10)>0){
				delivery_charge2 = delivery_charge2 + (10 - (delivery_charge2%10));
				}
				
				document.getElementById("deliverycharge").innerHTML = "<br><div class=\"alert alert-info\"><font size=\"4dp\">Signature: </font><font color=\"red\">Rs. "+delivery_charge1+"</font>.&nbsp;&nbsp;&nbsp;&nbsp;<font size=\"4dp\">Express:</font> <font color=\"red\">Rs. "+delivery_charge2+"</font>. <font size=\"4dp\">Distance:</font> <font color=\"red\">"+distance_ceil+"km</font></div>";
			}
			}
		});
		
	}

// This example displays an address form, using the autocomplete feature
// of the Google Places API to help users fill in the information.

/*var placeSearch, autocomplete;
var componentForm = {
  street_number: 'short_name',
  route: 'long_name',
  locality: 'long_name',
  administrative_area_level_1: 'short_name',
  country: 'long_name',
  postal_code: 'short_name'
};*/

function initAutocomplete() {
  // Create the autocomplete object, restricting the search to geographical
  // location types.
  var options = {
  componentRestrictions: {country: "in"}
 };
  
	autocomplete1 = new google.maps.places.Autocomplete(
      /** @type {!HTMLInputElement} */(document.getElementById('address1')),
      options);

	autocomplete2 = new google.maps.places.Autocomplete(
      /** @type {!HTMLInputElement} */(document.getElementById('address2')),
      {types: ['geocode']});
  // When the user selects an address from the dropdown, populate the address
  // fields in the form.
  autocomplete1.addListener('place_changed', fillInAddress);
  autocomplete2.addListener('place_changed', fillInAddress);
}

// [END region_fillform]

// [START region_geolocation]
// Bias the autocomplete object to the user's geographical location,
// as supplied by the browser's 'navigator.geolocation' object.
function geolocate() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
      var geolocation = {
        lat: position.coords.latitude,
        lng: position.coords.longitude
      };
      var circle = new google.maps.Circle({
        center: geolocation,
        radius: position.coords.accuracy
      });
      autocomplete.setBounds(circle.getBounds());
    });
  }
}
// [END region_geolocation]
</script>

<script>
$(document).ready(function() {
    $('#validation')
        .formValidation({
            framework: 'bootstrap',
            icon: {
                valid: 'glyphicon glyphicon-ok',
                invalid: 'glyphicon glyphicon-remove',
                validating: 'glyphicon glyphicon-refresh'
            },
            fields: {
                number1: {
                    validators: {
                        phone: {
                            country: 'IN',
                            message: 'The value is not valid %s phone number'
                        }
                    }
                }
            }
        })
});
</script>
<body>
<br><br>
<center><h1>Calculate the distance</h1></center>
<br>
<!-- Form for entering loations-->
	<div class="row">
				<div class="col-md-2">
				</div>
				<div class="col-md-8">
				<center><form class="form-inline" role="form">
				  <div class="form-group">
				    <input type="text" name="address1" id="address1"size="45dp" class="form-control" onFocus="geolocate()" placeholder="Pickup Address"/>
				  </div>
				  <br><br>
 				  <div class="form-group">
				    <input type="text" name="address1" id="address2" size="45dp" class="form-control" onFocus="geolocate()" placeholder="Delivery Address"/>
				  </div>
				</center>	<br>
				<center><input type="number" min="1" name="weight" id="weight" size="10dp" placeholder="Weight"/></center><br>
				<center>
					<input type="button" class="btn btn-primary btn-lg" value="Book Now" id="booknow" onClick="initialize(this.id)"/>
				</center>
				</form>
				</div>
			</div>
			<div class="row">
				<center><div style="width:100%; height:10%" id="deliverycharge"></div></center><br>
				</div>
							<style type="text/css">
								 #map-container1 { height: 400px }
							    </style>
								</div>
								
			<div class="col-md-2">
			</div>
			<div id="map-container1" class="col-md-8" style="display:none;"></div>
			</div>
</div>
<!-- Form for entering loations END-->


  </div>
</div>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAVOB6qYFgyFWHkbVi2T3lBE2m8_kxQmgI&signed_in=true&libraries=places&callback=initAutocomplete"
        async defer></script>
</body>
</html>